<script type="text/javascript">
  function updateDropdowns(){
    Ext.Ajax.request({
        url: '<%= dropdown_content_laereplansok_path %>',
        timeout: 3000,
        method: 'GET',
        params: Ext.Ajax.serializeForm('laereplan_sok'),
        success: function(xhr) {
          var jsonData = Ext.util.JSON.decode(xhr.responseText);
          var kompetansemaal_options = jsonData['kompetansemaalsett_options'];
          var trinn_options = jsonData['trinn_options'];
          kompetansemaalsett.store.loadData(kompetansemaal_options);
          trinn.store.loadData(trinn_options);
        }
    });
}
</script>

<% form_tag(laereplansok_index_path, :method => "get", :id => 'laereplan_sok') do %>
	<%= label_tag :laereplansok_laereplan_kode, t("laereplankode") %>
	<%= text_field :laereplansok, :laereplan_kode, :onchange => "updateDropdowns()" %><br />
	<%= label_tag :laereplansok_laereplan_tittel, t("laereplantittel") %>
	<%= text_field :laereplansok, :laereplan_tittel, :onchange => "updateDropdowns()" %><br />
  
  <%# Hovedområder skal få "kode" i fremtiden, til de får dette, vil vi ikke vise søkefelt for kode til brukerene i prod %>
  <% if RAILS_ENV == 'test' || RAILS_ENV == 'development'%>
    <%= label_tag :laereplansok_hovedomraade_kode, t("hovedomraadekode") %>
    <%= text_field :laereplansok, :hovedomraade_kode %><br />
  <% end %>
  
  <%= label_tag :laereplansok_hovedomraade_uuid, t("hovedomraade") %>
	<%= select( :laereplansok, :hovedomraade_uuid, @hovedomraader_options, { :include_blank => true }) %><br />
  
	<%= label_tag :laereplansok_kompetansemaalsett_uuid, t("kompetansemaalsett") %>
	<%= select( :laereplansok, :kompetansemaalsett_uuid, @kompetansemaalsett_options, { :include_blank => true }) %><br />
	<%= label_tag :laereplansok_trinn_uuid, t("trinn") %>
	<%= select( :laereplansok, :trinn_uuid, @trinn_options, { :include_blank => true }) %><br />
	<%= label_tag :laereplansok_kompetansemaal_tittel, t("kompetansemaaltittel") %>
	<%= text_field :laereplansok, :kompetansemaal_tittel %><br />
	<%= submit_tag "Søk", :name => nil, :class => 'submit' %>
<% end %>
<%= render :partial => 'kompetansemaal/ext_list' %>

<%= render :partial => 'kompetansemaal/selected_kompetansemaal' %>

<script type="text/javascript">
  var hovedomraade = new Ext.form.ComboBox({
    emptyText: "Velg et hovedområde...",
    typeAhead: true,
    triggerAction: 'all',
    transform:'laereplansok_hovedomraade_uuid',
  });

  var kompetansemaalsett = new Ext.form.ComboBox({
    emptyText: "Velg et kompetansemålsett...",
    typeAhead: true,
    triggerAction: 'all',
    transform:'laereplansok_kompetansemaalsett_uuid',
  });

  var trinn = new Ext.form.ComboBox({
    emptyText: "Velg et trinn...",
    typeAhead: true,
    triggerAction: 'all',
    transform:'laereplansok_trinn_uuid',
  });

</script>
